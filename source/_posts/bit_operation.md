title: 位运算
date: 2014-11-15 05:29:12
tags: 位运算
categore: 计算机基础
description: 记录位运算的相关运用
---

总是容易遗忘位运算的用法，今天特意做个记录
## 与（&）
先看下面的几个运算结果
``` bash
  0 & 0 = 0  
  0 & 1 = 0  
  1 & 0 = 0  
  1 & 1 = 1  
```
通过这四个运算式可以得出以下几个结论：
  1. 由1、2、3、4可以得出只有两边都是1的情况下运算结果才为1
  2. 由1、3可以得出任何数与0相与结果为0
  3. 由2、4可以得出任何数与1相与结果不变
这样我们就得出了以上3个结论，那么这些结论有什么用呢？
### 判断奇偶数
应用上面的结论3，与1相与，如果结果为0，则表示是偶数；如果结果为1，则表示是奇数
``` bash
  a&1
```

### 取第k位
先右移k位，在与1相与。应用的是上面的结论3
``` bash
  a>>(k - 1)&1
```

### 第k位置为0
先左移k位，在与1相与。应用的是上面的结论2
``` bash
  a&~(1 << (k - 1))
```

### 取最后k位
先左移k+1位，然后再减1，即变成一个k位都是1的数，这样与1相与还是本身，就能获取后k位的了。应用的是上面的结论3
``` bash
  a&((1 << k) - 1)
```

### 判断一个数是不是2的幂
``` bash
  ((x&(x-1))==0)&&(x!=0)
```
如果一个数是2的幂，则其二进制表示形式类似1000，则x-1为0111，那么相与的结果为0
需要排除x=0的情况  

### 2的n次方取余
正常表示为： x % y，其中y为2的n次方，下面是位运算计算方法
``` bash
  x & (y - 1)
```
y是2的n次方，则y的二进制表示类似1000，y-1则为0111，然后与x相与的结果就是取最后几个为1的位  

## 或（|）
先看下面的几个运算结果
``` bash
  0 | 0 = 0  
  0 | 1 = 1  
  1 | 0 = 1  
  1 | 1 = 1  
```
通过这四个运算式可以得出以下几个结论：
  1. 由1、2、3、4可以得出只有两边都是0的情况下运算结果才为0
  2. 由1、3可以得出任何数与0相或结果不变
  3. 由2、4可以得出任何数与1相与结果都是1
  
### 第k位置为1
``` bash
  a | (1 << (k - 1))
```

### 最后一位置为1
``` bash
  a | 1
```

### 将最后一位置为0
应用上面的结论3，任何数与1相与结果为1，然后减1可以将奇数变为相近的偶数
``` bash
  (a | 1) - 1
```

### 将奇数变为偶数
应用上面的结论3，任何数与1相与结果为1，然后减1可以将奇数变为相近的偶数
``` bash
  (a | 1) - 1
```

### 将末k位变成1
应用上面的结论3，任何数与1相与结果为1，然后减1可以将奇数变为相近的偶数
``` bash
  a | ((1 << k) -1)
```


## 异或（^）
先看下面的几个运算结果
``` bash
  0 ^ 0 = 0  
  0 ^ 1 = 1  
  1 ^ 0 = 1  
  1 ^ 1 = 0  
```
通过这四个运算式可以得出以下几个结论：
  1. 由1、2、3、4可以得出只有两边相同为0，两边不同为1
  2. 由1、3可以得出任何数与0相结果不变
  3. 由2、4可以得出任何数与1相异或结果取反
 
### 将最后一位取反

``` bash
  a ^ 1
```

### 将第K位取反

``` bash
  a ^ (1 << (k - 1))
```

### 将末K位取反

``` bash
  a ^ ((1 << k )- 1)
```

### 交换两个数的值
``` bash
  x ^= y
  y ^= x
  x ^= y
```
### 判断符号是否相同
``` bash
  (x ^ y) >= 0 
```
如果符号位相同则异或的结果1

### 求平均值，防止溢出
求两个数的平均值一般想到的就是:(x + y) / 2，但是当x、y很大的情况下，二者相加的结果可能会溢出。可以通过位运算来避免
``` bash
 x & y + ((x ^ y) >> 1)
```
怎么来理解这个表达式呢，首先我们单纯的将x + y按照位相加来理解，那么每个位上相加的结果会有三种组合：
1. 两位上都是1
2. 只有1位为1（包含1 0 和 0 1）
3. 两位都是0
拆分成这种形式后我们分别对每部分求平均值，于是
1. 两位上都是1的平均值结果为： x & y
2. 只有1位为1（包含1 0 和 0 1）的平均值为：(x ^ y) >> 1
3. 两位都是0的平均值为0
这三部分相加的结果就是上面的表达式  


### 获取一个数绝对值
``` bash
  (n ^ (n >> 31)) - (n >> 31)
```
或者
``` bash
  (n + (n >> 31)) ^ (n >> 31)
```

## 非（~）
先看下面的几个运算结果
``` bash
  ~0 = 1  
  ~1 = 0  
```
非是单目运算符，所以只有两个运算结果。
通过这两个运算式可以得出的结论：
  1. 非的结果是按位取反
  
